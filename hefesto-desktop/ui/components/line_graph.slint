import { Theme } from "../theme.slint";

export struct GraphPoint {
    value: float,
}

export component LineGraph inherits Rectangle {
    in property <string> title: "Graph";
    in property <string> current-value: "--";
    in property <color> line-color: Theme.accent;
    in property <[GraphPoint]> data-points: [];
    in property <int> max-points: 60;

    background: Theme.bg-primary;
    border-radius: Theme.radius-md;
    border-width: 1px;
    border-color: Theme.border;
    min-height: 180px;

    VerticalLayout {
        padding: Theme.space-sm;
        spacing: Theme.space-xs;

        // Header row
        HorizontalLayout {
            spacing: Theme.space-sm;

            Text {
                text: root.title;
                font-size: Theme.font-size-sm;
                font-weight: 700;
                color: Theme.fg-secondary;
                horizontal-stretch: 1;
            }

            Text {
                text: root.current-value;
                font-size: Theme.font-size-lg;
                font-weight: 700;
                color: root.line-color;
            }
        }

        // Graph area
        HorizontalLayout {
            spacing: 2px;
            vertical-stretch: 1;

            // Y-axis labels
            VerticalLayout {
                width: 32px;
                spacing: 0;

                Text {
                    text: "100%";
                    font-size: 8px;
                    color: Theme.fg-muted;
                    vertical-alignment: top;
                    vertical-stretch: 1;
                }

                Text {
                    text: "50%";
                    font-size: 8px;
                    color: Theme.fg-muted;
                    vertical-alignment: center;
                    vertical-stretch: 1;
                }

                Text {
                    text: "0%";
                    font-size: 8px;
                    color: Theme.fg-muted;
                    vertical-alignment: bottom;
                    vertical-stretch: 1;
                }
            }

            // Chart area
            Rectangle {
                horizontal-stretch: 1;
                background: Theme.bg-secondary.with-alpha(0.5);
                border-radius: Theme.radius-sm;
                clip: true;

                // Grid lines at 25%, 50%, 75%
                Rectangle {
                    y: parent.height * 0.25;
                    width: 100%;
                    height: 1px;
                    background: Theme.border.with-alpha(0.2);
                }

                Rectangle {
                    y: parent.height * 0.50;
                    width: 100%;
                    height: 1px;
                    background: Theme.border.with-alpha(0.3);
                }

                Rectangle {
                    y: parent.height * 0.75;
                    width: 100%;
                    height: 1px;
                    background: Theme.border.with-alpha(0.2);
                }

                // Data bars (vertical bars from bottom representing value)
                for point[idx] in root.data-points: Rectangle {
                    property <float> bar-height-ratio: clamp(point.value / 100.0, 0.0, 1.0);
                    property <float> step-width: parent.width / (root.max-points * 1px);

                    x: (step-width * idx) * 1px;
                    y: parent.height * (1.0 - bar-height-ratio);
                    width: max(step-width * 1px - 1px, 1px);
                    height: parent.height * bar-height-ratio;
                    background: root.line-color.with-alpha(0.25);

                    // Dot at the top of each bar
                    Rectangle {
                        width: min(parent.width, 4px);
                        height: 3px;
                        border-radius: 1px;
                        background: root.line-color;
                    }
                }
            }
        }
    }
}
