import { Button, TextEdit, CheckBox } from "std-widgets.slint";
import { Theme } from "../theme.slint";
import { StatusBadge } from "../components/status_badge.slint";

export component ToolsView inherits Rectangle {
    // i18n labels
    in property <string> label-base64:        "Base64";
    in property <string> label-json:          "JSON";
    in property <string> label-encode:        "Encode";
    in property <string> label-decode:        "Decode";
    in property <string> label-url-safe:      "URL-safe";
    in property <string> label-mime:          "MIME";
    in property <string> label-format:        "Format";
    in property <string> label-compact:       "Compact";
    in property <string> label-validate:      "Validate";
    in property <string> label-copy:          "Copy";
    in property <string> label-clear:         "Clear";
    in property <string> label-input:         "Input";
    in property <string> label-output:        "Output";
    in property <string> label-valid:         "Valid JSON";
    in property <string> label-invalid:       "Invalid JSON";

    // State
    in-out property <int> active-tab: 0;  // 0 = base64, 1 = json

    // Base64 state
    in-out property <string> b64-input:   "";
    in-out property <string> b64-output:  "";
    in property <string> b64-error:       "";
    in-out property <bool> b64-url-safe:  false;
    in-out property <bool> b64-mime:      false;

    // JSON state
    in-out property <string> json-input:  "";
    in-out property <string> json-output: "";
    in property <int> json-valid: -1;  // -1=unknown, 0=invalid, 1=valid

    callback b64-encode();
    callback b64-decode();
    callback b64-clear();
    callback b64-copy-output();
    callback json-format();
    callback json-compact();
    callback json-validate();
    callback json-clear();
    callback json-copy-output();

    background: Theme.bg-secondary;

    VerticalLayout {
        padding: Theme.space-md;
        spacing: 0;

        // Tab bar
        HorizontalLayout {
            spacing: 0;
            height: 40px;

            // Base64 tab
            Rectangle {
                horizontal-stretch: 1;
                background: root.active-tab == 0 ? Theme.bg-primary : Theme.bg-surface;
                border-radius: Theme.radius-sm;

                TouchArea {
                    clicked => { root.active-tab = 0; }
                }

                Text {
                    text: root.label-base64;
                    font-size: Theme.font-size-base;
                    font-weight: root.active-tab == 0 ? 700 : 400;
                    color: root.active-tab == 0 ? Theme.accent : Theme.fg-secondary;
                    horizontal-alignment: center;
                    vertical-alignment: center;
                }
            }

            // JSON tab
            Rectangle {
                horizontal-stretch: 1;
                background: root.active-tab == 1 ? Theme.bg-primary : Theme.bg-surface;
                border-radius: Theme.radius-sm;

                TouchArea {
                    clicked => { root.active-tab = 1; }
                }

                Text {
                    text: root.label-json;
                    font-size: Theme.font-size-base;
                    font-weight: root.active-tab == 1 ? 700 : 400;
                    color: root.active-tab == 1 ? Theme.accent : Theme.fg-secondary;
                    horizontal-alignment: center;
                    vertical-alignment: center;
                }
            }
        }

        Rectangle { height: Theme.space-sm; }

        // Base64 panel
        if root.active-tab == 0: VerticalLayout {
            spacing: Theme.space-sm;
            vertical-stretch: 1;

            Text {
                text: root.label-input;
                font-size: Theme.font-size-sm;
                font-weight: 700;
                color: Theme.fg-primary;
            }

            TextEdit {
                vertical-stretch: 1;
                text <=> root.b64-input;
                font-size: Theme.font-size-base;
            }

            // Toolbar
            HorizontalLayout {
                spacing: Theme.space-sm;

                Button {
                    text: root.label-encode;
                    clicked => { root.b64-encode(); }
                }
                Button {
                    text: root.label-decode;
                    clicked => { root.b64-decode(); }
                }
                CheckBox {
                    text: root.label-url-safe;
                    checked <=> root.b64-url-safe;
                }
                CheckBox {
                    text: root.label-mime;
                    checked <=> root.b64-mime;
                }

                Rectangle { horizontal-stretch: 1; }

                Button {
                    text: root.label-clear;
                    clicked => { root.b64-clear(); }
                }
                Button {
                    text: root.label-copy;
                    clicked => { root.b64-copy-output(); }
                }
            }

            Text {
                text: root.label-output;
                font-size: Theme.font-size-sm;
                font-weight: 700;
                color: Theme.fg-primary;
            }

            TextEdit {
                vertical-stretch: 1;
                text <=> root.b64-output;
                read-only: true;
                font-size: Theme.font-size-base;
            }

            if root.b64-error != "": Text {
                text: root.b64-error;
                font-size: Theme.font-size-sm;
                color: Theme.danger;
            }
        }

        // JSON panel
        if root.active-tab == 1: VerticalLayout {
            spacing: Theme.space-sm;
            vertical-stretch: 1;

            Text {
                text: root.label-input;
                font-size: Theme.font-size-sm;
                font-weight: 700;
                color: Theme.fg-primary;
            }

            TextEdit {
                vertical-stretch: 1;
                text <=> root.json-input;
                font-size: Theme.font-size-base;
            }

            // Toolbar
            HorizontalLayout {
                spacing: Theme.space-sm;

                Button {
                    text: root.label-format;
                    clicked => { root.json-format(); }
                }
                Button {
                    text: root.label-compact;
                    clicked => { root.json-compact(); }
                }
                Button {
                    text: root.label-validate;
                    clicked => { root.json-validate(); }
                }

                if root.json-valid >= 0: StatusBadge {
                    label: root.json-valid == 1 ? root.label-valid : root.label-invalid;
                    severity: root.json-valid == 1 ? 1 : 3;
                }

                Rectangle { horizontal-stretch: 1; }

                Button {
                    text: root.label-clear;
                    clicked => { root.json-clear(); }
                }
                Button {
                    text: root.label-copy;
                    clicked => { root.json-copy-output(); }
                }
            }

            Text {
                text: root.label-output;
                font-size: Theme.font-size-sm;
                font-weight: 700;
                color: Theme.fg-primary;
            }

            TextEdit {
                vertical-stretch: 1;
                text <=> root.json-output;
                read-only: true;
                font-size: Theme.font-size-base;
            }
        }
    }
}
